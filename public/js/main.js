"use strict";function _createForOfIteratorHelper(e,i){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||i&&e&&"number"==typeof e.length){t&&(e=t);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,n=!0,r=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return n=e.done,e},e:function(e){r=!0,d=e},f:function(){try{n||null==t.return||t.return()}finally{if(r)throw d}}}}function _unsupportedIterableToArray(e,i){if(e){if("string"==typeof e)return _arrayLikeToArray(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,i):void 0}}function _arrayLikeToArray(e,i){(null==i||i>e.length)&&(i=e.length);for(var t=0,a=new Array(i);t<i;t++)a[t]=e[t];return a}function initItemPanel(){$.ajax({method:"GET",url:"/api/itemList",success:function(e){var a,e=JSON.parse(e),l=[],i=_createForOfIteratorHelper(e);try{var t=function(){var d,n=a.value,e='<a href="#tab-'+n.tab+'" class="mdui-ripple mdui-ripple-white">'+n.tab+"</a>",r='<div id="tab-'+n.tab+'" class="mdui-panel mdui-shadow-0 mdui-panel-gapless" mdui-panel="{accordion:true}"><div class="mdui-panel-item"><div class="mdui-panel-item-header"><label class="mdui-radio"></label><div class="mdui-panel-item-summary head-font">设备</div><div class="mdui-panel-item-summary head-font">状态</div><div class="mdui-panel-item-summary head-font">使用者</div>'+(n.header?n.header.map(function(e){return'<div class="mdui-panel-item-summary panel-material head-font">'+e+"</div>"}).join(""):"")+(n.showTimeInfo?'<div class="mdui-panel-item-summary panel-rented head-font">预约开始时间</div><div class="mdui-panel-item-summary panel-expired head-font">预约结束时间</div>':"")+'<i class="mdui-panel-item-arrow mdui-icon material-icons" style="visibility: hidden;">keyboard_arrow_down</i></div></div>',i='<div id="input-row-'+n.tab+'" class="input-row mdui-row">'+(n.showTimeInfo?'<div class="mdui-col-xs-'+Math.floor(12/((n.header?n.header.length:0)+(n.showTimeInfo?1:0)))+'"><div class="mdui-textfield  mdui-textfield-floating-label"><label class="mdui-textfield-label">预约日期</label><input id="datepicker-'+n.tab+'" autocomplete="off" class="datepicker mdui-textfield-input" type="text" required/><div class="mdui-textfield-error">请选择预约日期</div></div></div>':"")+(n.header?n.header.map(function(e){return'<div class="mdui-col-xs-'+Math.floor(12/((n.header?n.header.length:0)+(n.showTimeInfo?1:0)))+'"><div class="mdui-textfield mdui-textfield-floating-label"><label class="mdui-textfield-label">'+e+'</label><input class="'+e+'-input mdui-textfield-input" type="text" required/><div class="mdui-textfield-error">请输入'+e+"</div></div></div>"}).join(""):"")+"</div>",t=_createForOfIteratorHelper(n.list);try{for(t.s();!(d=t.n()).done;)!function(){var i=d.value;i.Attach=JSON.parse(i.Attach),l.push({id:i.ItemID,header:n.header,showTimeInfo:n.showTimeInfo});var e=void 0,t=void 0,a=new Date(i.Expired);n.showTimeInfo?a<new Date?(e="可预约",t="status-idle",i.UserName="无",i.Rented="无",i.Expired="无",n.header&&n.header.forEach(function(e){i.Attach[e]="无"})):(e="已预约",t="status-busy"):(e="可预约",t="status-idle",i.UserName||(i.UserName="无"),n.header&&n.header.forEach(function(e){i.Attach[e]||(i.Attach[e]="无")})),r+='<div id="panel-item-'+i.ItemID+'" class="mdui-panel-item"><div class="mdui-panel-item-header"><label class="mdui-radio"><input id="selector-'+i.ItemID+'" type="radio" name="panel-selector"/><i class="mdui-radio-icon"></i></label><div class="mdui-panel-item-summary">'+(i.Description?'<div class="panel-item">'+i.Item+'</div><div class="panel-description">'+i.Description+"</div>":'<div class="panel-item">'+i.Item+"</div>")+'</div><div class="mdui-panel-item-summary '+t+'">'+e+'</div><div class="mdui-panel-item-summary">'+i.UserName+"</div>"+(n.header?n.header.map(function(e){return'<div class="mdui-panel-item-summary panel-attach">'+i.Attach[e]+"</div>"}).join(""):"")+(n.showTimeInfo?'<div class="mdui-panel-item-summary panel-rented">'+i.Rented+'</div><div class="mdui-panel-item-summary panel-expired">'+i.Expired+"</div>":"")+'<i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i></div><div class="mdui-panel-item-body"><div class="mdui-spinner mdui-center"></div></div></div>'}()}catch(e){t.e(e)}finally{t.f()}r=r+'<div class="mdui-divider"></div>'+i+"</div>",$("header .mdui-tab").append(e),$("#main-card").prepend(r),laydate.render({elem:"#datepicker-"+n.tab,theme:"#3F51B5",calendar:!0,type:"datetime",range:!0,min:0,trigger:"click",done:function(){setTimeout(function(){$(".datepicker").trigger("blur")},20)}})};for(i.s();!(a=i.n()).done;)t()}catch(e){i.e(e)}finally{i.f()}$("header .mdui-tab").attr("mdui-tab",""),mdui.mutation();for(var d=0,n=l;d<n.length;d++)!function(){var e=n[d];$("#panel-item-"+e.id).on("opened.mdui.panel",function(){initHistory(e)})}()}})}function initHistory(r){$.ajax({method:"GET",url:"/api/history",data:{id:r.id},success:function(e){var a,i=JSON.parse(e).history,d=JSON.parse(e).order,n="",t=_createForOfIteratorHelper(i);try{for(t.s();!(a=t.n()).done;)if("break"===function(){var i=a.value,e=void 0,t=void 0,e=new Date(i.Expired)>new Date?(t="status-undone","待完成"):(t="status-done","已完成"),e='<tr><td class="col-time">'+i.Time+'</td><td class="'+t+'">'+e+"</td><td>"+i.UserName+"</td>"+(r.header?r.header.map(function(e){return"<td>"+JSON.parse(i.Attach)[e]+"</td>"}).join(""):"")+(r.showTimeInfo?"<td>"+i.Rented+"</td><td>"+i.Expired+"</td>":"")+"</tr>";if("asc"==d)n+=e;else{if("desc"!=d)return console.error("History Order Error!"),"break";n=e+n}}())break}catch(e){t.e(e)}finally{t.f()}n='<div class="mdui-table-fluid mdui-shadow-0 mdui-table-hoverable"><table class="mdui-table mdui-table-selectable"><thead><tr><th>预约时间</th><th>预约状态</th><th>使用者</th>'+(r.header?r.header.map(function(e){return"<th>"+e+"</th>"}).join(""):"")+(r.showTimeInfo?"<th>开始时间</th><th>结束时间</th>":"")+"</tr></thead><tbody>"+n+"</tbody></table></div>",$("#panel-item-"+r.id+" .mdui-panel-item-body").empty(),$("#panel-item-"+r.id+" .mdui-panel-item-body").append(n),mdui.mutation()}})}function checkRePWD(){var e=!1,i=$("#signup-pwd input").val(),t=$("#signup-repwd input").val();""==t?(e=!0,$("#signup-repwd .mdui-textfield-error").text("重复密码不能为空")):t!=i&&(e=!0,$("#signup-repwd .mdui-textfield-error").text("两次输入密码不同")),e?$("#signup-repwd").addClass("mdui-textfield-invalid"):$("#signup-repwd").removeClass("mdui-textfield-invalid")}function login(){var e=$("#login-user input").val(),i=$("#login-pwd input").val(),t=$("#login-check").is(":checked"),i=CryptoJS.SHA256(i).toString();$.ajax({method:"POST",url:"/api/login",data:{id:e,pwd:i,isRemember:t},success:function(e){e=JSON.parse(e);e.isAccountExist?1==e.isLogin?window.location.href="/":($("#login-pwd .mdui-textfield-error").text("密码错误"),$("#login-pwd").addClass("mdui-textfield-invalid")):($("#login-pwd .mdui-textfield-error").text("用户不存在"),$("#login-pwd").addClass("mdui-textfield-invalid"))}})}function signup(){var e=$("#signup-user input").val(),i=$("#signup-name input").val(),t=$("#signup-pwd input").val(),a=$("#signup-repwd input").val();""!=e&&""!=i&&""!=t&&""!=a&&t==a&&(t=CryptoJS.SHA256(t).toString(),$.ajax({method:"POST",url:"/api/signup",data:{id:e,name:i,pwd:t},success:function(e){var i=JSON.parse(e),e=new mdui.Dialog("#login-card-dialog");i.enableSignUp?i.isNameExist?initDialog($("#login-card-dialog"),"账户已存在","账户已存在",function(){$("#tab-signup").find(".mdui-textfield-input").val("")}):initDialog($("#login-card-dialog"),"注册成功","注册成功，请登录",function(){$("#tab-signup").find(".mdui-textfield-input").val(""),new mdui.Tab("#tab-head").show(0)}):initDialog($("#login-card-dialog"),"注册已关闭","注册功能已关闭",function(){$("#tab-signup").find(".mdui-textfield-input").val("")}),e.open()}}))}var $=mdui.$;function submit(){var t,e,d={},a={},i=$(".mdui-tab-active").text(),n=$("#input-row-"+i+" .datepicker"),r=!0;null==n.val()?(e=!0,a.Rented="1970-01-01 00:00:00",a.Expired="1970-01-01 00:00:01"):""!=n.val()&&(e=!0,a.Rented=n.val().split(" - ")[0],a.Expired=n.val().split(" - ")[1]),$('input[name="panel-selector"]').each(function(e,i){i=$(i);i.prop("checked")&&(a.ItemID=Number(i.attr("id").split("-")[1]),t=!0)}),$("#input-row-"+i+" input").not(".datepicker").each(function(e,i){var t=$(i).attr("class").split("-")[0],a=$(i).val();r=!!a&&(d[t]=$(i).val(),!0)}),a.Attach=d,a.Tab=i,t?r&&e?$.ajax({method:"POST",url:"/api/submit",data:a,success:function(e){JSON.parse(e).success?(refreshPanel(),mdui.snackbar("预约成功！")):mdui.snackbar("该设备已被预约！")}}):mdui.snackbar("请填写预约信息！"):mdui.snackbar("请选择预约的设备！")}function refreshPanel(){$("#main-card .mdui-panel").remove(),$("header .mdui-tab").remove(),$("header").append('<div class="mdui-tab mdui-tab-full-width mdui-color-blue-600"></div>'),initItemPanel()}function deleteHistory(){var t=[];$(".mdui-table-row-selected .col-time").text(function(e,i){t.push(i)}),t.length?$.ajax({method:"POST",url:"/api/delete",data:{history:t},success:function(e){JSON.parse(e).isAdmin?(refreshPanel(),mdui.snackbar("删除成功！")):mdui.snackbar("改完还是无权进行操作，请联系管理员")}}):mdui.snackbar("未选中需删除的记录")}function changeNightMode(){var e;$("body").hasClass("mdui-theme-layout-dark")?($("body").removeClass("mdui-theme-layout-dark"),(e=$(".theme-dark-element")).removeClass("theme-dark-element"),e.addClass("mdui-color-theme-600"),localStorage.removeItem("RS4SOFC-dark")):($("body").addClass("mdui-theme-layout-dark"),(e=$(".mdui-color-theme-600")).removeClass("mdui-color-theme-600"),e.addClass("theme-dark-element"),localStorage.setItem("RS4SOFC-dark",!0))}function showAnnouncement(t){$.ajax({method:"GET",url:"/api/announcement",success:function(e){var i=JSON.parse(e),e=new mdui.Dialog("#announcement-dialog",{modal:!0,closeOnEsc:!1});(t||i.autoShow)&&(initDialog($("#announcement-dialog"),"公告",i.content),e.open())}})}function initDialog(e,i,t,a){e.find(".mdui-dialog-title").text(i),e.find(".mdui-dialog-content").text(t),null!=a&&e.on("closed.mdui.dialog",function(){a(),e.off("closed.mdui.dialog")})}$(function(){var e;"true"==localStorage.getItem("RS4SOFC-dark")&&($("body").addClass("mdui-theme-layout-dark"),(e=$(".mdui-color-theme-600")).removeClass("mdui-color-theme-600"),e.addClass("theme-dark-element"),$("#nightmode_switch").prop("checked",!0)),"/"==window.location.pathname&&($("body").addClass("mdui-appbar-with-toolbar mdui-appbar-with-tab"),initItemPanel(),showAnnouncement(!1))});
//# sourceMappingURL=main.js.map
